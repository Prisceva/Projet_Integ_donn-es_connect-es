<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<title>PROJET API</title>
	</head>
	<body>
		<p>test 6 </p>
		<select id="dep">
		</select>
		<button type="button" onclick="retrouverVarDep()">rechercher</button>
				
		
	</body>
	<script>
	
	function retrouverVarDep(){
		console.log(document.getElementById("dep").value);
	}
	
	
	//API MDPH
	var result_MDPH;
	fetch('https://api.opendata.onisep.fr/api/1.0/dataset/57e13aa4a3cee/search?size=300')
	  .then(function(response) {
	    response.json()
		.then(function(data) {
	    console.log('Request successful');
		result_MDPH=data;
		//api 'premise' si on veut sortir du fetch
		var tout_dep=[];
		for(i in result_MDPH.results){
			//console.log(result_MDPH.results[i]["departement"]);
			tout_dep.push(result_MDPH.results[i]["departement"]);
		}
		//console.log(tout_dep);
		//fonction pour supprimer les doublons des departements.
		const unique = (value, index, self) => {
			return self.indexOf(value) === index
		}
		const uniqueDep=tout_dep.filter(unique);
		console.log(uniqueDep);//liste unique avec les 101 dep francais
		
		uniqueDep.sort();//tri en ordre croissant la liste des departements
		
		var mesOptions = "";
		for(i in uniqueDep){
			mesOptions=mesOptions+"<option value="+uniqueDep[i]+">"+uniqueDep[i]+"</option>";
			//console.log(uniqueDep[i]);
		} 
		var monDep = document.getElementById("dep");
		monDep.innerHTML = mesOptions;
		
			
		
	  })})
		result_MDPH;

	//API ULIS
	var result_ULIS;
	fetch('https://api.opendata.onisep.fr/api/1.0/dataset/57e13d4faa63e/search?size=1000&facet.region=Occitanie')
	  .then(function(response) {
	    response.json()
		.then(function(data) {
	    console.log('Request successful'); result_ULIS=data;
		    // recuperer les ulyss

		    var dep= "01 - Ain";
		    var handicap= "trouble de la santé"
		    var nom_u = new Array;
		    var commune_u= new Array;
		    var type_detablissement= new Array;
		    
		    
		    for (i=0;i<result_ULIS.results.length;i++){
			    if (result_UlIS.results[i]["type_handicap_principal"] == "troubles de la santé" && result_Ulis.results[i]["departement"]=="Paris") {
				    nom_u.push(result_ULIS.results[i]["nom"]);
				    commune.push(result_ULIS.results[i]["commune"]);
				    type_etablie.push(result_ULIS.results[i]["type_detablissement"])
				    <!-- rajouter peut etre adresse-->
			    }
		    };

	  })})
	result_ULIS;
		
		
		
	//API Associations
	var result_Assos ;
	fetch('https://api.opendata.onisep.fr/api/1.0/dataset/57e1376b0f7fb/search?size=100')
	  .then(function(response) {
	    response.json()
		.then(function(data) {
	    console.log('Request successful'); result_Assos=data;
	  })})
	result_Assos;
	
	</script>
	
</html>
